{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 73, "column": 0}, "map": {"version":3,"sources":["file:///Users/connorlaughlin/Desktop/Coding/Antigravity/TSI%20Marketing%20Machine/tsi-dashboard/lib/file-system.ts"],"sourcesContent":["import fs from 'fs';\nimport path from 'path';\nimport matter from 'gray-matter';\nimport { remark } from 'remark';\nimport html from 'remark-html';\nimport type {\n  Asset,\n  AssetSummary,\n  AssetFrontmatter,\n  IntelBriefing,\n  IntelAlert,\n  SystemHealth,\n  AutopilotAction,\n  PublishableItem,\n  Vertical,\n  ContentType,\n  ContentStatus,\n  HealthStatus,\n  VaultFilters,\n} from './types';\n\n// Base path to parent directory (TSI Marketing Machine)\nconst BASE_PATH = path.join(process.cwd(), '..');\n\n// Directory paths\nconst PATHS = {\n  finalAssets: path.join(BASE_PATH, 'final_assets'),\n  drafts: path.join(BASE_PATH, 'drafts'),\n  intelligence: path.join(BASE_PATH, 'docs', 'intelligence'),\n  reports: path.join(BASE_PATH, 'docs', 'reports'),\n  systemLogs: path.join(BASE_PATH, 'system_logs'),\n  healthFile: path.join(BASE_PATH, 'system_logs', 'daily_health.md'),\n  autopilotLog: path.join(BASE_PATH, 'docs', 'reports', 'autopilot_log.md'),\n  publishQueue: path.join(BASE_PATH, 'final_assets', 'ready_to_publish'),\n};\n\n// Helper: Parse content type from string\nfunction parseContentType(str?: string): ContentType {\n  if (!str) return 'Unknown';\n  const normalized = str.toLowerCase().replace(/[^a-z]/g, '');\n  const mapping: Record<string, ContentType> = {\n    email: 'Email',\n    linkedin: 'LinkedIn',\n    linkedinpost: 'LinkedIn',\n    brochure: 'Brochure',\n    casestudy: 'CaseStudy',\n    whitepaper: 'Whitepaper',\n    blogpost: 'BlogPost',\n    blog: 'BlogPost',\n    salesemail: 'SalesEmail',\n    newsletter: 'Newsletter',\n    webpage: 'WebPage',\n    web: 'WebPage',\n  };\n  return mapping[normalized] || 'Unknown';\n}\n\n// Helper: Parse vertical from string\nfunction parseVertical(str?: string): Vertical {\n  if (!str) return 'ARM';\n  const normalized = str.toLowerCase().replace(/[^a-z]/g, '');\n  if (normalized.includes('arm') || normalized.includes('receivable') || normalized.includes('debt')) {\n    return 'ARM';\n  }\n  if (normalized.includes('health') || normalized.includes('rcm')) {\n    return 'Healthcare';\n  }\n  if (normalized.includes('bpo') || normalized.includes('customer')) {\n    return 'BPO';\n  }\n  if (normalized.includes('debtnext') || normalized.includes('rrm')) {\n    return 'DebtNext';\n  }\n  if (normalized.includes('loan') || normalized.includes('servic')) {\n    return 'LoanServicing';\n  }\n  return 'ARM';\n}\n\n// Helper: Parse status from string\nfunction parseStatus(str?: string): ContentStatus {\n  if (!str) return 'DRAFT';\n  const normalized = str.toUpperCase();\n  if (normalized.includes('PUBLISH')) return 'PUBLISHED';\n  if (normalized.includes('APPROV')) return 'APPROVED';\n  if (normalized.includes('ARCHIV')) return 'ARCHIVED';\n  return 'DRAFT';\n}\n\n// Helper: Extract date from filename or frontmatter\nfunction extractDate(filename: string, frontmatter?: { date?: string }): string {\n  if (frontmatter?.date) return frontmatter.date;\n  const match = filename.match(/(\\d{4}-\\d{2}-\\d{2})/);\n  return match ? match[1] : new Date().toISOString().split('T')[0];\n}\n\n// Helper: Create slug from filename\nfunction createSlug(filename: string): string {\n  return filename.replace(/\\.md$/, '').replace(/[^a-zA-Z0-9-_]/g, '-');\n}\n\n// Helper: Recursively get all markdown files in directory\nfunction getMarkdownFiles(dir: string): string[] {\n  if (!fs.existsSync(dir)) return [];\n\n  const files: string[] = [];\n  const entries = fs.readdirSync(dir, { withFileTypes: true });\n\n  for (const entry of entries) {\n    const fullPath = path.join(dir, entry.name);\n    if (entry.isDirectory()) {\n      files.push(...getMarkdownFiles(fullPath));\n    } else if (entry.name.endsWith('.md')) {\n      files.push(fullPath);\n    }\n  }\n\n  return files;\n}\n\n// Helper: Parse markdown to HTML\nasync function parseMarkdown(content: string): Promise<string> {\n  const result = await remark().use(html).process(content);\n  return result.toString();\n}\n\n// Get recent assets from final_assets and drafts\nexport async function getRecentAssets(limit: number = 10, vertical?: Vertical): Promise<AssetSummary[]> {\n  const assets: AssetSummary[] = [];\n\n  // Get from both final_assets and drafts\n  const dirs = [PATHS.finalAssets, PATHS.drafts];\n\n  for (const dir of dirs) {\n    const files = getMarkdownFiles(dir);\n\n    for (const filePath of files) {\n      try {\n        const content = fs.readFileSync(filePath, 'utf-8');\n        const { data } = matter(content);\n        const filename = path.basename(filePath);\n\n        const assetVertical = parseVertical(data.vertical);\n        if (vertical && assetVertical !== vertical) continue;\n\n        assets.push({\n          slug: createSlug(filename),\n          title: data.title || filename.replace(/\\.md$/, '').replace(/[-_]/g, ' '),\n          vertical: assetVertical,\n          contentType: parseContentType(data.content_type),\n          status: parseStatus(data.status),\n          date: extractDate(filename, data),\n          excerpt: content.slice(0, 200).replace(/^---[\\s\\S]*?---/, '').trim(),\n          filePath,\n        });\n      } catch {\n        // Skip files that can't be read\n      }\n    }\n  }\n\n  // Sort by date descending and limit\n  return assets\n    .sort((a, b) => b.date.localeCompare(a.date))\n    .slice(0, limit);\n}\n\n// Get all assets with filters\nexport async function getAllAssets(filters?: VaultFilters): Promise<AssetSummary[]> {\n  const assets = await getRecentAssets(1000);\n\n  if (!filters) return assets;\n\n  return assets.filter((asset) => {\n    if (filters.search) {\n      const search = filters.search.toLowerCase();\n      if (!asset.title.toLowerCase().includes(search)) return false;\n    }\n    if (filters.verticals?.length && !filters.verticals.includes(asset.vertical)) {\n      return false;\n    }\n    if (filters.contentTypes?.length && !filters.contentTypes.includes(asset.contentType)) {\n      return false;\n    }\n    if (filters.statuses?.length && !filters.statuses.includes(asset.status)) {\n      return false;\n    }\n    if (filters.dateRange) {\n      if (asset.date < filters.dateRange.start || asset.date > filters.dateRange.end) {\n        return false;\n      }\n    }\n    return true;\n  });\n}\n\n// Get single asset by slug\nexport async function getAssetBySlug(slug: string): Promise<Asset | null> {\n  const dirs = [PATHS.finalAssets, PATHS.drafts];\n\n  for (const dir of dirs) {\n    const files = getMarkdownFiles(dir);\n\n    for (const filePath of files) {\n      const filename = path.basename(filePath);\n      if (createSlug(filename) === slug) {\n        try {\n          const rawMarkdown = fs.readFileSync(filePath, 'utf-8');\n          const { data, content: markdownContent } = matter(rawMarkdown);\n          const htmlContent = await parseMarkdown(markdownContent);\n\n          return {\n            slug,\n            title: data.title || filename.replace(/\\.md$/, '').replace(/[-_]/g, ' '),\n            vertical: parseVertical(data.vertical),\n            contentType: parseContentType(data.content_type),\n            status: parseStatus(data.status),\n            date: extractDate(filename, data),\n            content: htmlContent,\n            rawMarkdown,\n            frontmatter: data as AssetFrontmatter,\n            filePath,\n          };\n        } catch {\n          return null;\n        }\n      }\n    }\n  }\n\n  return null;\n}\n\n// Get intel briefings\nexport async function getIntelBriefings(limit: number = 20, vertical?: Vertical): Promise<IntelBriefing[]> {\n  const briefings: IntelBriefing[] = [];\n  const files = getMarkdownFiles(PATHS.intelligence);\n\n  for (const filePath of files) {\n    const filename = path.basename(filePath);\n\n    // Only process intel briefing files\n    if (!filename.startsWith('intel_briefing_')) continue;\n\n    try {\n      const rawContent = fs.readFileSync(filePath, 'utf-8');\n      const { data, content } = matter(rawContent);\n\n      // Extract vertical from filename (e.g., intel_briefing_2026-01-21_ARM.md)\n      const verticalMatch = filename.match(/intel_briefing_\\d{4}-\\d{2}-\\d{2}_(\\w+)\\.md/i);\n      const briefingVertical = parseVertical(verticalMatch?.[1] || data.vertical);\n\n      if (vertical && briefingVertical !== vertical) continue;\n\n      // Parse alerts from content\n      const alerts: IntelAlert[] = [];\n      const alertMatches = content.matchAll(/###\\s*(.+?)\\n\\*\\s*\\*\\*Link\\*\\*:\\s*(\\S+)\\n\\*\\s*\\*\\*Date\\*\\*:\\s*(.+)/g);\n\n      for (const match of alertMatches) {\n        alerts.push({\n          type: 'market',\n          title: match[1].trim(),\n          summary: `Source: ${match[2]}`,\n          source: match[2],\n          urgency: 'medium',\n        });\n      }\n\n      briefings.push({\n        id: createSlug(filename),\n        date: extractDate(filename, data),\n        vertical: briefingVertical,\n        title: data.title || `${briefingVertical} Market Intel`,\n        alerts,\n        recommendation: content.match(/## Recommendation\\n(.+)/)?.[1]?.trim(),\n        content: await parseMarkdown(content),\n        filePath,\n      });\n    } catch {\n      // Skip files that can't be read\n    }\n  }\n\n  return briefings\n    .sort((a, b) => b.date.localeCompare(a.date))\n    .slice(0, limit);\n}\n\n// Get system health status\nexport async function getSystemHealth(): Promise<SystemHealth> {\n  const defaultHealth: SystemHealth = {\n    status: 'GREEN',\n    message: 'System operational',\n    lastCheck: new Date().toISOString(),\n    details: {\n      agentsOnline: 22,\n      totalAgents: 22,\n      publishQueueCount: 0,\n      recentErrors: [],\n    },\n  };\n\n  try {\n    if (!fs.existsSync(PATHS.healthFile)) {\n      return defaultHealth;\n    }\n\n    const content = fs.readFileSync(PATHS.healthFile, 'utf-8');\n\n    // Parse the markdown table for the latest status\n    const lines = content.split('\\n');\n    let lastStatus: HealthStatus = 'GREEN';\n    let lastMessage = 'System operational';\n    let lastDate = new Date().toISOString().split('T')[0];\n\n    for (const line of lines) {\n      const match = line.match(/\\|\\s*(\\d{4}-\\d{2}-\\d{2})\\s*\\|\\s*(GREEN|YELLOW|RED)\\s*\\|\\s*(.+?)\\s*\\|/);\n      if (match) {\n        lastDate = match[1];\n        lastStatus = match[2] as HealthStatus;\n        lastMessage = match[3];\n      }\n    }\n\n    // Count publish queue items\n    let publishQueueCount = 0;\n    if (fs.existsSync(PATHS.publishQueue)) {\n      publishQueueCount = getMarkdownFiles(PATHS.publishQueue).length;\n    }\n\n    return {\n      status: lastStatus,\n      message: lastMessage,\n      lastCheck: lastDate,\n      details: {\n        agentsOnline: 22,\n        totalAgents: 22,\n        publishQueueCount,\n        recentErrors: [],\n      },\n    };\n  } catch {\n    return defaultHealth;\n  }\n}\n\n// Get recent autopilot actions\nexport async function getRecentActions(limit: number = 10): Promise<AutopilotAction[]> {\n  const actions: AutopilotAction[] = [];\n\n  try {\n    if (!fs.existsSync(PATHS.autopilotLog)) {\n      return actions;\n    }\n\n    const content = fs.readFileSync(PATHS.autopilotLog, 'utf-8');\n    const blocks = content.split(/### Run: /);\n\n    for (const block of blocks) {\n      if (!block.trim()) continue;\n\n      // Extract timestamp\n      const timestampMatch = block.match(/^(\\d{4}-\\d{2}-\\d{2}\\s+\\d{2}:\\d{2}:\\d{2})/);\n      if (!timestampMatch) continue;\n\n      const timestamp = timestampMatch[1];\n\n      // Extract actions\n      const actionLines = block.split('\\n').filter((line) => line.startsWith('*'));\n\n      for (const line of actionLines) {\n        const verticalMatch = line.match(/\\[(\\w+)\\]/);\n        const vertical = verticalMatch ? parseVertical(verticalMatch[1]) : undefined;\n\n        // Determine action type and details\n        let action = 'System Activity';\n        let details = line.replace(/^\\*\\s*/, '').replace(/\\[.*?\\]\\s*/, '').trim();\n        let status: AutopilotAction['status'] = 'info';\n\n        if (line.includes('News found')) {\n          action = 'Intel Gathered';\n          status = 'success';\n        } else if (line.includes('Draft')) {\n          action = 'Draft Created';\n          status = 'success';\n        } else if (line.includes('workflows executed')) {\n          action = 'Workflows Executed';\n          status = 'success';\n        } else if (line.includes('Error') || line.includes('error')) {\n          status = 'error';\n        } else if (line.includes('Warning') || line.includes('warning')) {\n          status = 'warning';\n        }\n\n        actions.push({\n          timestamp,\n          vertical,\n          action,\n          details,\n          status,\n        });\n      }\n    }\n  } catch {\n    // Return empty array on error\n  }\n\n  // Sort by timestamp descending and limit\n  return actions\n    .sort((a, b) => b.timestamp.localeCompare(a.timestamp))\n    .slice(0, limit);\n}\n\n// Get publishable items from queue\nexport async function getPublishQueue(): Promise<PublishableItem[]> {\n  const items: PublishableItem[] = [];\n\n  // Check for ready_to_publish directory\n  if (!fs.existsSync(PATHS.publishQueue)) {\n    // Also check for APPROVED items in final_assets\n    const assets = await getRecentAssets(100);\n    return assets\n      .filter((a) => a.status === 'APPROVED')\n      .map((a) => ({\n        id: a.slug,\n        path: a.filePath,\n        platform: a.contentType === 'LinkedIn' ? 'linkedin' as const : 'zoho' as const,\n        title: a.title,\n        vertical: a.vertical,\n        contentType: a.contentType,\n      }));\n  }\n\n  const files = getMarkdownFiles(PATHS.publishQueue);\n\n  for (const filePath of files) {\n    try {\n      const content = fs.readFileSync(filePath, 'utf-8');\n      const { data } = matter(content);\n      const filename = path.basename(filePath);\n\n      items.push({\n        id: createSlug(filename),\n        path: filePath,\n        platform: data.platform || (data.content_type === 'LinkedIn' ? 'linkedin' : 'zoho'),\n        title: data.title || filename.replace(/\\.md$/, ''),\n        vertical: parseVertical(data.vertical),\n        contentType: parseContentType(data.content_type),\n        scheduledFor: data.scheduled_for,\n      });\n    } catch {\n      // Skip files that can't be read\n    }\n  }\n\n  return items;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 471, "column": 0}, "map": {"version":3,"sources":["file:///Users/connorlaughlin/Desktop/Coding/Antigravity/TSI%20Marketing%20Machine/tsi-dashboard/app/actions.ts"],"sourcesContent":["'use server';\n\nimport { revalidatePath } from 'next/cache';\nimport { execSync } from 'child_process';\nimport path from 'path';\nimport { getPublishQueue } from '@/lib/file-system';\nimport type { ActionResponse, Vertical, Platform, PublishableItem } from '@/lib/types';\n\n// Base path to parent directory\nconst BASE_PATH = path.join(process.cwd(), '..');\n\n/**\n * Refresh the dashboard page data\n */\nexport async function refreshDashboard(): Promise<ActionResponse> {\n  try {\n    revalidatePath('/');\n    return { success: true, message: 'Dashboard refreshed' };\n  } catch (error) {\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Refresh the intel page data\n */\nexport async function refreshIntel(): Promise<ActionResponse> {\n  try {\n    revalidatePath('/intel');\n    return { success: true, message: 'Intel refreshed' };\n  } catch (error) {\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Refresh the vault page data\n */\nexport async function refreshVault(): Promise<ActionResponse> {\n  try {\n    revalidatePath('/vault');\n    return { success: true, message: 'Vault refreshed' };\n  } catch (error) {\n    return { success: false, error: String(error) };\n  }\n}\n\n/**\n * Trigger the autopilot runner\n * Executes the Python autopilot script with optional vertical filter\n */\nexport async function triggerAutopilot(\n  verticals?: Vertical[],\n  dryRun: boolean = false\n): Promise<ActionResponse> {\n  try {\n    const scriptPath = path.join(BASE_PATH, 'scripts', 'autopilot_runner.py');\n    let command = `python3 \"${scriptPath}\"`;\n\n    // Add dry-run flag if specified\n    if (dryRun) {\n      command += ' --dry-run';\n    }\n\n    // Add vertical filter if specified\n    if (verticals && verticals.length > 0) {\n      command += ` --verticals ${verticals.join(',')}`;\n    }\n\n    console.log(`[Autopilot] Running: ${command}`);\n\n    // Execute the autopilot script\n    const output = execSync(command, {\n      cwd: BASE_PATH,\n      encoding: 'utf-8',\n      timeout: 300000, // 5 minute timeout\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    console.log(`[Autopilot] Output: ${output}`);\n\n    // Revalidate all pages\n    revalidatePath('/');\n    revalidatePath('/intel');\n    revalidatePath('/vault');\n\n    return {\n      success: true,\n      message: `Autopilot completed for ${verticals?.join(', ') || 'all verticals'}`,\n      data: output,\n    };\n  } catch (error) {\n    console.error('[Autopilot] Error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Publish an asset to a platform\n * Executes the publish_content.py script\n */\nexport async function publishAsset(\n  platform: Platform,\n  filePath: string,\n  dryRun: boolean = false\n): Promise<ActionResponse> {\n  try {\n    const scriptPath = path.join(BASE_PATH, 'scripts', 'publish_content.py');\n    let command = `python3 \"${scriptPath}\" --platform ${platform} --file \"${filePath}\"`;\n    if (dryRun) {\n      command += ' --dry-run';\n    }\n\n    console.log(`[Publish] Running: ${command}`);\n\n    // Execute the publish script\n    const output = execSync(command, {\n      cwd: BASE_PATH,\n      encoding: 'utf-8',\n      timeout: 120000, // 2 minute timeout\n      stdio: ['pipe', 'pipe', 'pipe'],\n    });\n\n    console.log(`[Publish] Output: ${output}`);\n\n    // Revalidate relevant pages\n    revalidatePath('/');\n    revalidatePath('/vault');\n\n    return {\n      success: true,\n      message: `Published to ${platform}`,\n      data: output,\n    };\n  } catch (error) {\n    console.error('[Publish] Error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Get the publish queue as a server action\n */\nexport async function getPublishQueueAction(): Promise<ActionResponse<PublishableItem[]>> {\n  try {\n    const items = await getPublishQueue();\n    return {\n      success: true,\n      data: items,\n    };\n  } catch (error) {\n    console.error('[PublishQueue] Error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n\n/**\n * Create a reaction asset from an intel briefing\n */\nexport async function createReactionAsset(\n  briefingId: string,\n  vertical: Vertical\n): Promise<ActionResponse> {\n  try {\n    // This would typically trigger an agent workflow\n    // For now, we'll just log the request\n    console.log(`[ReactionAsset] Creating for briefing ${briefingId}, vertical ${vertical}`);\n\n    return {\n      success: true,\n      message: `Reaction asset queued for ${vertical}`,\n    };\n  } catch (error) {\n    console.error('[ReactionAsset] Error:', error);\n    return {\n      success: false,\n      error: error instanceof Error ? error.message : String(error),\n    };\n  }\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 673, "column": 0}, "map": {"version":3,"sources":["file:///Users/connorlaughlin/Desktop/Coding/Antigravity/TSI%20Marketing%20Machine/tsi-dashboard/.next-internal/server/app/intel/page/actions.js%20%28server%20actions%20loader%29"],"sourcesContent":["export {triggerAutopilot as '605cb1c2e35f1e4429892c59cdfa7a8d1c12479336'} from 'ACTIONS_MODULE0'\nexport {publishAsset as '708bef6abe21fc311dd754f1b8d633e3ca2a152036'} from 'ACTIONS_MODULE0'\nexport {getPublishQueueAction as '007348100226a0906d1aa37b280acf67b46ebc0029'} from 'ACTIONS_MODULE0'\n"],"names":[],"mappings":";AAAA"}}]
}